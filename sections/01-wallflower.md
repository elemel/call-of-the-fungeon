# Chapter 1: Wallflower

You have entered a dungeon. You stand at the bottom of the staircase where you entered, facing east. A gnomish cartographer, carrying a bundle of scrolls, peers at you from an adjacent tile. As he steps onto the staircase, he thrusts a scroll into your hands. Before you can respond, he has already left the dungeon.

Unrolling the scroll, you identify it as a magic map. It ripples and shifts into a symbolic representation of the dungeon:

```
###################]##]######]#######]#############[####]####################
##################[..]......]......]#....]######]#[.###]...]#################
##############][.......]#]#...[###..].[#..]##[#]....[#]..[.#########[########
######]######[......[#.[]....[.#][..[..#[..][.#..[...]..[..#####]##[.#[######
######.]#####]..]]...][.##[]#]....[.]..##[......]#[..[.[..]###][.....[.######
###][#....]###[]...]....[[.##[.]....#].###....[.]##[...].].]#]...[[....[#####
#]].....[..]##]#.#..].#]#]......]]..#..[##[.#.]..][#[..[.#.#]...[##.[....]###
#....[.[.[...]...][.#.####..]...[..]#.##]#[...#]...[#[]#...[..[####.].[[]####
#.][...[.[[#...].##.#.####[..][]].....[#.]].[][..]..[##][#...[###[...][.#####
]...[..]..#[[].].[....]####[...]..[###[......[..]#]..##.]][#####][[]....[####
##.[[.......][]#]#[]#.[#####[....]#####..[.....]#]...[.......]#]..][..[..]###
#]..]..#[.....[######[#######[]#.[#####[.]..##]]#..[[...[.[#]]##]...[##[..]##
##].#]..].#.]..#][##[.[#########[#####[..#].][#.]...#[].]..[#.]#].]..[##[..]#
#]..[#[.].#.[.....[....]][#####[.#[##[..]##]....[##.[....]..#.[]...]..[[.[..]
#..[....#]].#..].[#[].....[####]...[##.]####].#.###.#.#[]##.]..##].#].<[.#[.#
#.[..]...]#]#[.]..[....[.][###[..]..##....]].....]].#.[.##[....[....]]...[..#
[...]##[]#####.##.#[#].]...[#[..]##.#[..[......].#..[.].....[].#.#[]##[....]#
#.#]#########].#[...##.[[...[..]##[...[[#[.......#.[..#[###]][.#.]####]....##
].############]##.[.[...[.]...][###.[...[..#[...][...]#####]...[..]####]....]
#]###############[]...[#]..]....[#].].]...]##.[]#].#]#######].....[#####..[]#
#####################]###[]##[#####]#]###]###[####]#############[]######[####
```

The staircase is marked `<` on the map, with east to the right. You are compelled to walk through the dungeon, always step forward when possible, and turn only when instructed. Stepping onto floor tiles (marked `.`) has no particular effect.

The dungeon contains wall tiles: left-turners (marked `[`), right-turners (marked `]`), and halters (marked `#`). Whenever you would step onto a wall tile, stay and turn instead. This still counts as a step. For a left-turner, turn 90 degrees to the left. For a right-turner, turn 90 degrees to the right. For a halter, turn 0 degrees, in effect halting indefinitely.

As demonstrated by the gnome, you leave the dungeon by stepping onto the staircase from an adjacent tile. After how many steps do you leave the dungeon?


## Example

Consider an example dungeon:

```
#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########
```

Below is a log of walking through the example dungeon. Your coordinates are shown as `(x, y, z)`, and your location is marked `@` on the map.

```
Step count: 0
Coordinates: (15, 2, 0)
Direction: East
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......@]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 1
Coordinates: (15, 2, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......@]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 2
Coordinates: (15, 3, 0)
Direction: South
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].@...[]#
#[].........]##[#]####
##########[]##########

---

Step count: 3
Coordinates: (15, 3, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].@...[]#
#[].........]##[#]####
##########[]##########

---

Step count: 4
Coordinates: (16, 3, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]..@..[]#
#[].........]##[#]####
##########[]##########

---

Step count: 5
Coordinates: (17, 3, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]...@.[]#
#[].........]##[#]####
##########[]##########

---

Step count: 6
Coordinates: (18, 3, 0)
Direction: East
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]....@[]#
#[].........]##[#]####
##########[]##########

---

Step count: 7
Coordinates: (18, 3, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]....@[]#
#[].........]##[#]####
##########[]##########

---

Step count: 8
Coordinates: (18, 2, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<].@..#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 9
Coordinates: (18, 1, 0)
Direction: North
Next symbol: ]

#######]######[##[]###
####]##...][...#[.@..]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 10
Coordinates: (18, 1, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[.@..]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 11
Coordinates: (19, 1, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[..@.]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 12
Coordinates: (20, 1, 0)
Direction: East
Next symbol: ]

#######]######[##[]###
####]##...][...#[...@]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 13
Coordinates: (20, 1, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][...#[...@]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 14
Coordinates: (20, 2, 0)
Direction: South
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]...@#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 15
Coordinates: (20, 2, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]...@#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 16
Coordinates: (19, 2, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]..@.#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 17
Coordinates: (18, 2, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<].@..#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 18
Coordinates: (17, 2, 0)
Direction: West
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]@...#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 19
Coordinates: (17, 2, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]@...#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 20
Coordinates: (17, 1, 0)
Direction: North
Next symbol: [

#######]######[##[]###
####]##...][...#[@...]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 21
Coordinates: (17, 1, 0)
Direction: West
Next symbol: [

#######]######[##[]###
####]##...][...#[@...]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 22
Coordinates: (17, 1, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][...#[@...]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 23
Coordinates: (17, 2, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]@...#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 24
Coordinates: (17, 3, 0)
Direction: South
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]...@.[]#
#[].........]##[#]####
##########[]##########

---

Step count: 25
Coordinates: (17, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]...@.[]#
#[].........]##[#]####
##########[]##########

---

Step count: 26
Coordinates: (16, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]..@..[]#
#[].........]##[#]####
##########[]##########

---

Step count: 27
Coordinates: (15, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].@...[]#
#[].........]##[#]####
##########[]##########

---

Step count: 28
Coordinates: (14, 3, 0)
Direction: West
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]@....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 29
Coordinates: (14, 3, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...]@....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 30
Coordinates: (14, 2, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[.....@<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 31
Coordinates: (14, 1, 0)
Direction: North
Next symbol: [

#######]######[##[]###
####]##...][..@#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 32
Coordinates: (14, 1, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][..@#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 33
Coordinates: (13, 1, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][.@.#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 34
Coordinates: (12, 1, 0)
Direction: West
Next symbol: [

#######]######[##[]###
####]##...][@..#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 35
Coordinates: (12, 1, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][@..#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 36
Coordinates: (12, 2, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[...@..<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 37
Coordinates: (12, 3, 0)
Direction: South
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[..@].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 38
Coordinates: (12, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[..@].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 39
Coordinates: (11, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[.@.].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 40
Coordinates: (10, 3, 0)
Direction: West
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[@..].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 41
Coordinates: (10, 3, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[@..].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 42
Coordinates: (10, 4, 0)
Direction: South
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].......@.]##[#]####
##########[]##########

---

Step count: 43
Coordinates: (10, 4, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].......@.]##[#]####
##########[]##########

---

Step count: 44
Coordinates: (11, 4, 0)
Direction: East
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]........@]##[#]####
##########[]##########

---

Step count: 45
Coordinates: (11, 4, 0)
Direction: South
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]........@]##[#]####
##########[]##########

---

Step count: 46
Coordinates: (11, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]........@]##[#]####
##########[]##########

---

Step count: 47
Coordinates: (10, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].......@.]##[#]####
##########[]##########

---

Step count: 48
Coordinates: (9, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]......@..]##[#]####
##########[]##########

---

Step count: 49
Coordinates: (8, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].....@...]##[#]####
##########[]##########

---

Step count: 50
Coordinates: (7, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]....@....]##[#]####
##########[]##########

---

Step count: 51
Coordinates: (6, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]...@.....]##[#]####
##########[]##########

---

Step count: 52
Coordinates: (5, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]..@......]##[#]####
##########[]##########

---

Step count: 53
Coordinates: (4, 4, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].@.......]##[#]####
##########[]##########

---

Step count: 54
Coordinates: (3, 4, 0)
Direction: West
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]@........]##[#]####
##########[]##########

---

Step count: 55
Coordinates: (3, 4, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[]@........]##[#]####
##########[]##########

---

Step count: 56
Coordinates: (3, 3, 0)
Direction: North
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[..@.[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 57
Coordinates: (3, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[..@.[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 58
Coordinates: (2, 3, 0)
Direction: West
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[.@..[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 59
Coordinates: (1, 3, 0)
Direction: West
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[@...[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 60
Coordinates: (1, 3, 0)
Direction: South
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[@...[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 61
Coordinates: (1, 3, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[@...[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 62
Coordinates: (2, 3, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[.@..[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 63
Coordinates: (3, 3, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[..@.[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 64
Coordinates: (4, 3, 0)
Direction: East
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[...@[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 65
Coordinates: (4, 3, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[......<]....#
[...@[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 66
Coordinates: (4, 2, 0)
Direction: North
Next symbol: ]

#######]######[##[]###
####]##...][...#[....]
###[@...[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 67
Coordinates: (4, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[@...[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 68
Coordinates: (5, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[.@..[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 69
Coordinates: (6, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[..@.[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 70
Coordinates: (7, 2, 0)
Direction: East
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[...@[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 71
Coordinates: (7, 2, 0)
Direction: North
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[...@[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 72
Coordinates: (7, 1, 0)
Direction: North
Next symbol: ]

#######]######[##[]###
####]##@..][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 73
Coordinates: (7, 1, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##@..][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 74
Coordinates: (8, 1, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##.@.][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 75
Coordinates: (9, 1, 0)
Direction: East
Next symbol: ]

#######]######[##[]###
####]##..@][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 76
Coordinates: (9, 1, 0)
Direction: South
Next symbol: .

#######]######[##[]###
####]##..@][...#[....]
###[....[......<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 77
Coordinates: (9, 2, 0)
Direction: South
Next symbol: [

#######]######[##[]###
####]##...][...#[....]
###[....[@.....<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 78
Coordinates: (9, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[@.....<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 79
Coordinates: (10, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[.@....<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 80
Coordinates: (11, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[..@...<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 81
Coordinates: (12, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[...@..<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 82
Coordinates: (13, 2, 0)
Direction: East
Next symbol: .

#######]######[##[]###
####]##...][...#[....]
###[....[....@.<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 83
Coordinates: (14, 2, 0)
Direction: East
Next symbol: <

#######]######[##[]###
####]##...][...#[....]
###[....[.....@<]....#
[....[###[...].....[]#
#[].........]##[#]####
##########[]##########

---

Step count: 84
```

You leave the example dungeon after 84 steps.
